---
title: "Use cases"
output:
  html_document:
    toc: true
---

<!-- # Simple cases -->
The following use cases were designed to illustrate Maximum Likelihood (ML) and
Bayesian parameter estimation for data collected using a revisit design. 

## No design weights | no covariance structure
The examples below assume that errors are not correlated within nor between 
measures. We also ignore aspects of membership design and any specification of design weights. 

#### A random-intercepts model for a normally-distributed outcome
Let's assume we've generated (and _downloaded_) revisit design data with the 
following structure: $[(1-0)^1, (2-3)^4]$ with 5 and 7 units in panels 1 and 2, 
respectively, for a total 33 units visited between 2008 and 2016. The 
hyperparameters we invoked in simulating the (normally-distributed) outcome 
were: $\sigma_{u_0}=1$, $\beta_0=3$, $\sigma_{\epsilon_0}=2$, and $\beta_1=1.5$.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, message=FALSE)
```

```{r}
library(dplyr)
library(ggplot2)
library(lme4)


csv_file <- '/Users/lukezachmann/Downloads/data-2017-02-01.csv'  # UPDATE!
dat <- read.csv(csv_file) %>%
  mutate(group=interaction(panel, subpanel, unit)) %>% 
  mutate(period=period-min(period))

p <- ggplot(dat %>% filter(is_sampled==1)) +
      geom_line(aes(x=period, y=y, group=interaction(panel, subpanel, unit),
                color=factor(panel))) +
   scale_color_brewer('Panel', type='qual', palette='Set1') +
  labs(x='Years elapsed since the first sampling event', y='Simulated outcome')
```

<br><center><div style="width:60%;"></p>
```{r, echo=FALSE}
p
```
<p style="text-align: justify; font-size:90%; width:100%;">
__Figure 1. Simulated data.__</p></div></center><br>


```{r}
# Complete (non-rotating) observations.
lmer(y ~ period + (1|group), data=dat)

# Incomplete (rotating) observations
lmer(y ~ period + (1|group), data=dat %>% filter(is_sampled==1))
```


#### A random-intercepts model for a Poisson-distributed outcome
```{r}
csv_file <- '/Users/lukezachmann/Downloads/data-2017-02-01-pois.csv'  # UPDATE!
dat <- read.csv(csv_file) %>%
  mutate(group=interaction(panel, subpanel, unit)) %>% 
  mutate(period=period-min(period))

p <- ggplot(dat %>% filter(is_sampled==1)) +
      geom_line(aes(x=period, y=y, group=interaction(panel, subpanel, unit),
                color=factor(panel))) +
   scale_color_brewer('Panel', type='qual', palette='Set1') +
  labs(x='Years elapsed since the first sampling event', y='Simulated outcome')
```

<br><center><div style="width:60%;"></p>
```{r, echo=FALSE}
p
```
<p style="text-align: justify; font-size:90%; width:100%;">
__Figure 1. Simulated data.__</p></div></center><br>


```{r}
# Complete (non-rotating) observations.
glmer(y ~ period + (1|group), data=dat, family=poisson)

# Incomplete (rotating) observations
glmer(y ~ period + (1|group), data=dat %>% filter(is_sampled==1), family=poisson)
```


<!-- # More involved cases -->
## TBD....

### Estimation with glm
We can obtain maximum likelihood estimates for the coefficients, along with frequentist t-values and confidence intervals with the ??glmer function.

### Estimation with Stan
Here is a Stan file that can be used to fit a Poisson glm without an offset.
